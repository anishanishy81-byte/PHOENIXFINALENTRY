<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix Oncopathology - Patient Data Management</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation Header -->
    <nav class="navbar hidden" id="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="logo-placeholder">
                    <i class="fas fa-dna"></i>
                </div>
                <span class="brand-text">Phoenix Oncopathology</span>
            </div>
            <div class="nav-menu">
                <a href="#" class="nav-link" onclick="showPage('home')">
                    <i class="fas fa-plus-circle"></i> Entry
                </a>
                <a href="#" class="nav-link" onclick="showPage('search')">
                    <i class="fas fa-search"></i> Records
                </a>
                <a href="#" class="nav-link admin-only" onclick="showPage('admin')">
                    <i class="fas fa-users-cog"></i> Admin
                </a>
                <a href="#" class="nav-link admin-only" onclick="showPage('logs')">
                    <i class="fas fa-history"></i> Logs
                </a>
                <div class="user-info">
                    <span class="user-name" id="currentUserName">User</span>
                    <span class="user-role" id="currentUserRole">Role</span>
                </div>
                <a href="#" class="nav-link" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="logo-large">
                        <i class="fas fa-dna"></i>
                    </div>
                    <h1>Phoenix Oncopathology</h1>
                    <p>Professional Oncological Pathology Data Management System</p>
                </div>
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <div class="input-wrapper">
                            <i class="fas fa-user input-icon"></i>
                            <input type="text" id="username" class="form-control engraved" placeholder="Enter username" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="input-wrapper">
                            <i class="fas fa-lock input-icon"></i>
                            <input type="password" id="password" class="form-control engraved" placeholder="Enter password" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width btn-premium">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In
                    </button>
                </form>
                <div class="login-help">
                </div>
            </div>
        </div>
    </div>

    <!-- Home Page - Data Entry -->
    <div id="homePage" class="page">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-plus-circle"></i> Patient Data Entry</h1>
                <p>Enter new patient oncological pathology information</p>
            </div>
            
            <div class="entry-card">
                <form id="patientForm" class="patient-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">H Number</label>
                            <input type="text" id="hNumber" class="form-control engraved" readonly>
                            <small class="form-help">This number will increment only after successful save</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="text" id="entryDate" class="form-control engraved" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Patient Name</label>
                            <input type="text" id="patientName" class="form-control engraved" placeholder="Enter patient name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Age</label>
                            <input type="number" id="age" class="form-control engraved" placeholder="Age" min="0" max="150" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Gender</label>
                            <select id="gender" class="form-control engraved" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group dropdown-group">
                            <label class="form-label">Hospital Name</label>
                            <div class="searchable-dropdown">
                                <input type="text" id="hospitalInput" class="form-control engraved" placeholder="Search hospital..." required>
                                <div class="dropdown-list" id="hospitalDropdown"></div>
                                <button type="button" class="add-new-btn" onclick="addNewHospital()">
                                    <i class="fas fa-plus"></i> Add New
                                </button>
                            </div>
                        </div>
                        <div class="form-group dropdown-group">
                            <label class="form-label">Doctor Name</label>
                            <div class="searchable-dropdown">
                                <input type="text" id="doctorInput" class="form-control engraved" placeholder="Search doctor..." required>
                                <div class="dropdown-list" id="doctorDropdown"></div>
                                <button type="button" class="add-new-btn" onclick="addNewDoctor()">
                                    <i class="fas fa-plus"></i> Add New
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label class="form-label">Information</label>
                            <textarea id="information" class="form-control engraved" rows="4" placeholder="Enter received information..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Containers</label>
                            <input type="text" id="containers" class="form-control engraved" placeholder="Number of containers" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Test Type</label>
                            <select id="testType" class="form-control engraved" required>
                                <option value="">Select Test</option>
                                <option value="SMALL">SMALL</option>
                                <option value="MEDIUM">MEDIUM</option>
                                <option value="LARGE">LARGE</option>
                                <option value="EXTRA LARGE">EXTRA LARGE</option>
                                <option value="IHC">IHC</option>
                                <option value="EXPERT OPINION">EXPERT OPINION</option>
                                <option value="MSI">MSI</option>
                                <option value="BLANK">BLANK</option>
                            </select>
                        </div>
                    </div>

                    <!-- Google Sheets Configuration -->
                    <div class="form-row admin-only">
                        <div class="form-group full-width">
                            <label class="form-label">Google Sheets URL (Admin Only)</label>
                            <input type="url" id="googleSheetUrl" class="form-control engraved" 
                                   placeholder="https://script.google.com/macros/s/AKfycbx.../exec" 
                                   value="https://script.google.com/macros/s/AKfycbx1383kJqeD8hTxyXQneTva9t_yoNJqaekwnWZTlE-D-SpzQbVle9WYoPIwRpL5sJg/exec">
                            <small class="form-help">https://script.google.com/macros/s/AKfycbx1383kJqeD8hTxyXQneTva9t_yoNJqaekwnWZTlE-D-SpzQbVle9WYoPIwRpL5sJg/exec</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn--secondary" onclick="resetForm()">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                        <button type="submit" class="btn btn--primary btn-premium">
                            <i class="fas fa-save"></i> Save Entry
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Search Page -->
    <div id="searchPage" class="page">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-search"></i> Patient Records</h1>
                <p>Search and manage oncological pathology entries</p>
            </div>

            <div class="search-card">
                <div class="search-filters">
                    <div class="filter-group">
                        <input type="text" id="searchPatientName" class="form-control" placeholder="Patient Name">
                        <input type="text" id="searchHNumber" class="form-control" placeholder="H Number">
                    </div>
                    <div class="filter-group admin-only">
                        <input type="text" id="searchHospital" class="form-control" placeholder="Hospital Name">
                        <input type="text" id="searchTest" class="form-control" placeholder="Test Type">
                        <input type="date" id="searchDate" class="form-control">
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn--primary" onclick="searchEntries()">
                            <i class="fas fa-search"></i> Search
                        </button>
                        <button class="btn btn--secondary" onclick="clearSearch()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                        <button class="btn btn--outline" onclick="exportToCSV()">
                            <i class="fas fa-download"></i> Export CSV
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table id="entriesTable" class="entries-table">
                        <thead>
                            <tr>
                                <th>H Number</th>
                                <th>Date</th>
                                <th>Patient Name</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Hospital</th>
                                <th>Doctor</th>
                                <th>Test</th>
                                <th>User</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="entriesTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Page -->
    <div id="adminPage" class="page">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-users-cog"></i> Admin Dashboard</h1>
                <p>System administration and management controls</p>
            </div>

            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-medical"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalEntries">0</h3>
                        <p>Total Entries</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalUsers">5</h3>
                        <p>Total Users</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalLogins">0</h3>
                        <p>Total Logins</p>
                    </div>
                </div>
            </div>

            <div class="admin-controls">
                <h2><i class="fas fa-cogs"></i> Admin Controls</h2>
                <div class="control-actions">
                    <button class="btn btn--primary" onclick="resetHNumberCounter()">
                        <i class="fas fa-redo"></i> Reset H Number Counter
                    </button>
                    <button class="btn btn--outline" onclick="exportAllData()">
                        <i class="fas fa-download"></i> Export All Data
                    </button>
                    <button class="btn btn--secondary" onclick="clearAllLogs()">
                        <i class="fas fa-trash"></i> Clear Login Logs
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logs Page (Admin Only) -->
    <div id="logsPage" class="page">
        <div class="container">
            <div class="page-header">
                <h1><i class="fas fa-history"></i> Login Activity Logs</h1>
                <p>View user login and activity history</p>
            </div>

            <div class="login-activity-card">
                <h2><i class="fas fa-list"></i> Recent Login Activity</h2>
                <div class="table-container">
                    <table class="activity-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Full Name</th>
                                <th>Role</th>
                                <th>Login Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="loginActivityTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for editing entries -->
    <!-- (the rest of your HTML is preserved; truncated here for brevity) -->

    <!-- FIREBASE SDK (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
      // Firebase config you provided (integrated directly)
      const firebaseConfig = {
        apiKey: "AIzaSyA5jzvTz9dM46u3OPxaXdpeT1dbmSqW_VA",
        authDomain: "final-data-404f9.firebaseapp.com",
        projectId: "final-data-404f9",
        storageBucket: "final-data-404f9.firebasestorage.app",
        messagingSenderId: "1067605574799",
        appId: "1:1067605574799:web:68844a3d6a7d2a1587dcfa"
      };

      // Initialize Firebase & Firestore (compat)
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>

    <!-- Your updated app.js (Firestore-enabled) -->
    <script src="app.js"></script>
</body>
</html>
